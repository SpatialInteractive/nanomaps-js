/*
 * Nanomaps JavaScript Library
 * https://github.com/SpatialInteractive/nanomaps-js
 * Copyright 2011, Stella Laurenzo
 * Licensed under the MIT open source license
 * Version dev
 * Built by: stella@rhea at Mon Jul 11 16:04:00 PDT 2011
 * Origin: git@github.com:SpatialInteractive/nanomaps-js.git 
 * Branch: master
 * Revision: d81d3503befd934bdb369f94f84cf42da2ab014d
 */
(function(u){var K={};u.nanomaps=K;function k(){return function(){}}function W(az){if(Object.create){return Object.create(az)}var aA;if(az){aA=k();aA.prototype=az;return new aA()}return{}}function af(az,aA){var aB=W(aA.prototype);o(az.prototype,aB);az.prototype=aB}function o(aB,az){az=az||{};if(aB){for(var aA in aB){if(aB.hasOwnProperty(aA)){az[aA]=aB[aA]}}}return az}K.ObjectCreate=W;K.ObjectCopy=o;K.inherits=af;function M(){}var P=M.prototype={};P._evt=P.listeners=function(aA){var aB=this.__evt,az;if(!aB){this.__evt=aB={}}az=aB[aA];if(!az){az=aB[aA]=[]}return az};P.addListener=P.on=function(aA,az){this._evt(aA).push(az)};P.once=function(aA,az){this._evt(aA+"$once").push(az)};P.removeListener=function(az,aB){aA(this._evt(az));aA(this._evt(az+"$once"));function aA(aC){for(var aD=aC.length-1;aD>=0;aD--){if(aC[aD]===aB){aC.splice(aD,1)}}}};P.removeAllListeners=function(az){this._evt(az).length=0;this._evt(az+"$once").length=0};P.emit=function(aC){var az,aB,aA=Array.prototype.slice.call(arguments,1),aD=this["on"+aC];if(typeof aD==="function"){aD.apply(this,aA)}aB=this._evt(aC+"$once");for(az=0;az<aB.length;az++){aB[az].apply(this,aA)}aB.length=0;aB=this._evt(aC);for(az=0;az<aB.length;az++){aB[az].apply(this,aA)}};P.advise=function(az,aE,aB){var aC=this[az],aA,aD;if(!aC||!aC.__stub__||!this.hasOwnProperty(az)){aA=this[az]=J(aC)}else{aA=aC}aD=aA[aE];if(aD){aD.push(aB)}};function J(az){var aA=function(){var aE,aC=arguments.callee,aD,aB;aD=aC.before;for(aE=0;aE<aD.length;aE++){aD[aE].apply(this,arguments)}if(az){aB=az.apply(this,arguments)}aD=aC.after;for(aE=0;aE<aD.length;aE++){aD[aE].apply(this,arguments)}};aA.__stub__=true;aA.before=[];aA.after=[];return aA}function an(){return new Date().getTime()}function ah(az){return typeof az==="function"}function C(az){throw new Error("Object "+az+" is not a DOM element")}function aw(az){return Array.prototype.slice(az)}K.EventEmitter=M;var ad=!!window.addEventListener;function Q(aA,az){if(aA.currentStyle){return aA.currentStyle[az]}else{if(window.getComputedStyle){return aA.ownerDocument.defaultView.getComputedStyle(aA,"").getPropertyValue(az)}}return""}function V(az){var aA=Q(az,"position");return aA==="relative"||aA==="absolute"||aA==="fixed"}function aq(az){return window.HTMLElement?az instanceof HTMLElement:(az.nodeType===1)}function I(aB,aA,az){aB.addEventListener(aA,az,false)}function e(aB,aA,az){aB.removeEventListener(aA,az,false)}function n(az){if(ad){return az.button===0}else{return az.button===1}}function m(az){if(az.stopPropagation){az.preventDefault();az.stopPropagation()}else{az.cancelBubble=true;az.returnValue=false}}function q(){return document.createElement("div")}var f=["x","lng","longitude","lon"],aj=["y","lat","latitude"];function H(az,aB){var aC,aA,aD;for(aC=0;aC<aB.length;aC++){aA=az[aB[aC]];if(aA!==undefined&&aA!==null){aD=typeof aA;if(aD==="number"){return aA}else{if(aD==="function"){return Number(aA.call(az))}}}}return NaN}function l(aA,az){this._x=Number(aA);this._y=Number(az)}l.latLng=function(az,aA){return new l(aA,az)};l.xy=function(aA,az){return new l(aA,az)};l.from=function(az){if(az instanceof l){return az}if(az instanceof Array){return new l(az[0],az[1])}var aA=H(az,f),aB=H(az,aj);return new l(aA,aB)};l.prototype={x:function(){return this._x},y:function(){return this._y},lat:function(){return this._y},lng:function(){return this._x}};K.Coordinate=l;function t(az,aA,aB,aC){this.minx=az;this.miny=aA;this.maxx=aB;this.maxy=aC}function v(aC,aE,aB){var aF,aA,aD,az="";for(aF=aB;aF>0;aF--){aD=48;aA=1<<(aF-1);if((aC&aA)!==0){aD++}if((aE&aA)!==0){aD+=2}az+=String.fromCharCode(aD)}return az}var Y={WebMercator:function(aE){if(!aE){aE={}}this.DEFAULT_CENTER={lat:39.7406,lng:-104.985441};this.DEFAULT_RESOLUTION=611.4962;this.XINVERTED=false;this.YINVERTED=true;var aF=6378137,aG=0.017453292519943295,az=57.29577951308232,aB=0.7853981633974483,aD=1.5707963267948966,aC=78271.517;this.MIN_LEVEL=aE.MIN_LEVEL||1;this.MAX_LEVEL=aE.MAX_LEVEL||18;this.fwdX=function(aH){return aH*aG*aF};this.fwdY=function(aH){return Math.log(Math.tan(aB+0.5*aG*aH))*aF};this.invX=function(aH){return az*aH/aF};this.invY=function(aH){return az*(aD-2*Math.atan(Math.exp(-aH/aF)))};this.fromLevel=function(aH){return aC/Math.pow(2,aH-1)};this.toLevel=function(aH){return Math.log(aC/aH)/Math.log(2)+1};var aA=this.GLB_EXTENT=new t(-180,-85.05112878,180,85.05112878);this.PRJ_EXTENT=new t(this.fwdX(aA.minx),this.fwdY(aA.miny),this.fwdX(aA.maxx),this.fwdY(aA.maxy));aE=null}};K.Projections=Y;function h(aG,aA,aH,aB){var aE=3*aG,aC=3*(aH-aG)-aE,aI=1-aE-aC,aF=3*aA,aD=3*(aB-aA)-aF,az=1-aF-aD;return function(aK,aM){if(!aM){aM=[]}var aJ=aK*aK,aL=aJ*aK;aM[0]=aI*aL+aC*aJ+aE*aK;aM[1]=az*aL+aD*aJ+aF*aK;return aM}}var U={curve:h(0.25,0.25,0.25,0.25),duration:0.5,rate:10};function ao(az,aA){if(!aA){aA=U}this._f=az;this._c=aA.curve||U.curve;this._d=aA.duration||U.duration;this._r=aA.rate||U.rate;this._s=0}ao.prototype={start:function(){if(this._s!==0){return}var az=this,aB,aA;az._ts=an();az._td=az._d*1000;az._te=az._ts+az._td;az._tn=0;aB=az._d*az._r;aA=(az._te-az._ts)/aB;if(aA<=0){az._s=2;az._f(0,[0,0],true)}else{az._s=1;az._ii=setInterval(function(){az._frame()},aA);az._frame()}},finish:function(){this._last()},interrupt:function(){var aA=this,az=aA._ii;if(aA._s===2){return}if(az){clearInterval(az)}aA._s=2},_frame:function(){var aA=this,aB=an(),az=(aB-aA._ts)/aA._td,aC;if(az>=1||az<0||isNaN(az)){aA._final();return}aC=aA._c(az);aA._f(++aA._tn,aC,false)},_final:function(){var aA=this,az=aA._ii;if(aA._s===2){return}if(az){clearInterval(az)}aA._s=2;aA._f(aA._tn,[1,1],true);aA._f=null}};K.MakeBezierCurve=h;K.Animation=ao;function d(az){if(az){az.copy(this)}else{this.prj=null;this.res=1;this.x=0;this.y=0;this.w=0;this.h=0}this.finalState=null}d.prototype={compare:function(aA){var az=0;if(this.x!==aA.x||this.y!==aA.y||this.w!==aA.w||this.h!==aA.h){az=1}if(this.prj!==aA.prj||this.res!==aA.res){az=2}return az},copy:function(az){az.x=this.x;az.y=this.y;az.w=this.w;az.h=this.h;az.prj=this.prj;az.res=this.res},getZoom:function(){return this.prj.toLevel(this.res)},getDspX:function(aA,az){return this.x+aA},getDspY:function(aA,az){return this.y+az},getPrjX:function(aA,aB){var az=this.prj,aC=this.getDspX(aA,aB)*this.res;if(az.XINVERTED){aC=az.PRJ_EXTENT.maxx-aC}return aC},getPrjY:function(aA,aB){var az=this.prj,aC=this.getDspY(aA,aB)*this.res;if(az.YINVERTED){aC=az.PRJ_EXTENT.maxy-aC}return aC},getGlbX:function(aA,az){return this.prj.invX(this.getPrjX(aA,az))},getGlbY:function(aA,az){return this.prj.invY(this.getPrjY(aA,az))},prjToDspX:function(aA){var az=this.prj;if(az.XINVERTED){aA=az.PRJ_EXTENT.maxx-aA}return aA/this.res},prjToDspY:function(aA){var az=this.prj;if(az.YINVERTED){aA=az.PRJ_EXTENT.maxy-aA}return aA/this.res},setRes:function(aC,aA,aB){if(aC!==this.res){var aD=this.getPrjX(aA,aB),az=this.getPrjY(aA,aB);this.res=aC;this.setPrjXY(aD,az,aA,aB)}},setZoom:function(aB,aA,az){this.setRes(this.prj.fromLevel(aB),aA,az)},setDspXY:function(aC,az,aA,aB){this.x=aC-aA;this.y=az-aB},setPrjXY:function(aC,az,aA,aB){this.setDspXY(this.prjToDspX(aC),this.prjToDspY(az),aA,aB)},setGlbXY:function(aC,aD,aA,aB){var az=this.prj;this.setPrjXY(az.fwdX(aC),az.fwdY(aD),aA,aB)}};function F(aG,az){if(!az){az={}}var aC=az.document||aG.ownerDocument||window.document,aI=az.width,aB=az.height,aD,aA,aF,aE;function aH(aJ){return aC.createElement(aJ)}this.createElement=aH;this._layers=[];this._surfaces=[];aG.nmt="parent";aG.style.overflow="hidden";if(!V(aG)){aG.style.position="relative"}this.elements={document:aC,parent:aG};aA=this.layer(L.EVENT);aA.style.position="absolute";aA.style.left="0px";aA.style.top="0px";aA.style.width="100%";aA.style.height="100%";this.elements.event=aA;this.mapState=aF=new d();aF.prj=az.projection||new Y.WebMercator();aF.res=az.resolution||aF.prj.DEFAULT_RESOLUTION;this._zoomBias=az.zoomBias||0;this._pendMapState=new d(aF);this._pendLock=0;this._pendAnim=null;if(typeof aI!=="number"||typeof aB!=="number"){this.setSize();aI=aG.clientWidth;aB=aG.clientHeight}else{this.setSize(aI,aB)}this.initialize(az);this.collect()}var S=F.prototype=new M();function ar(az,aA){return(aA===undefined||aA===null)?az.mapState.w/2:Number(aA)}function ap(aA,az){return(az===undefined||az===null)?aA.mapState.h/2:Number(az)}function Z(az,aB){var aA=az.mapState.prj;aB=Number(aB);if(isNaN(aB)){aB=aA.MAX_LEVEL}if(aB<aA.MIN_LEVEL){aB=aA.MIN_LEVEL}else{if(aB>aA.MAX_LEVEL){aB=aA.MAX_LEVEL}}return aB}var L={BACKGROUND:0,MAP:10,SHADOW:50,EVENT:100,OVERLAY:1000,FOREGROUND:10000};function z(az){var aA=L[String(az).toUpperCase()];if(aA===undefined){aA=parseInt(az);if(isNaN(aA)){aA=L.FOREGROUND}}return aA}function ai(aI,az,aC){var aE=aC.res-az.res,aB=az.getPrjX(0,0),aG=az.getPrjY(0,0),aH=aC.getPrjX(0,0)-aB,aA=aC.getPrjY(0,0)-aG,aD=aC.w-az.w,aF=aC.h-az.h;az=new d(az);aC=new d(aC);updateMapState=new d(az);return function(aM,aK,aN){var aL=aK[0],aJ;if(aN){updateMapState=aC;aI._pendAnim=null;aI.mapState.finalState=null}else{updateMapState.res=az.res+aL*aE;updateMapState.setPrjXY(aB+aL*aH,aG+aL*aA,0,0);updateMapState.w=az.w+aL*aD;updateMapState.h=az.h+aL*aF}aJ=updateMapState.compare(aI.mapState);if(aJ>0){updateMapState.copy(aI.mapState);aI._invalidate(aJ>1)}}}S.begin=function(){return this._pendLock++===0};S.rollback=function(){this.mapState.copy(this._pendMapState);this._pendLock=0};S.commit=function(az){if(this._pendLock<=0||--this._pendLock>0){return false}var aA=this._pendMapState,aC=this.mapState,aD;var aB=aA.compare(aC);if(aB>0){if(this._pendAnim){this._pendAnim.interrupt();this._pendAnim=null;aC.finalState=null}if(!az){aA.copy(aC);this._invalidate(aB>1)}else{if(typeof az==="object"){aD=az}aC.finalState=new d(aA);this._pendAnim=new ao(ai(this,aC,aA),aD);this._pendAnim.start()}}return true};S.forceCommit=function(){this._pendLock=1;this.commit()};S.layer=function(az){var aD=this.elements.parent,aC=this._layers,aE,aF,aA=z(az),aB,aG;for(aF=0;aF<aC.length;aF++){aE=aC[aF];if(aE.ordinal===aA){return aE}}aE=this.createElement("div");aE.ordinal=aA;aE.nmt="layer";aE.setAttribute("layer",String(aA));aE.style.width="0px";aE.style.height="0px";aC.push(aE);for(aG=aD.firstChild;aG;aG=aG.nextSibling){if(aG.nodeType===1&&aG.nmt){aB=aG.ordinal;if(aB!==undefined&&aB>aA){break}}}aD.insertBefore(aE,aG);return aE};S.surface=function(aE){var aF=z(aE),aB=this.mapState,az=this._surfaces,aA,aC,aD;for(aC=0;aC<az.length;aC++){aA=az[aC];if(aA.ordinal===aF){return aA}}aA=this.createElement("div");aA.ordinal=aF;aA.nmt="surface";aA.className="managed";aA.style.position="absolute";aA.style.left=(-aB.x)+"px";aA.style.top=(-aB.y)+"px";az.push(aA);aD=this.layer(aF);aD.insertBefore(aA,aD.firstChild);return aA};S.getZoom=function(){return this._pendMapState.getZoom()-this._zoomBias};S.setZoom=function(aB,aA,aC){var az=this._pendMapState,aD=az.res;this.begin();aB=Z(this,aB+this._zoomBias);az.setZoom(aB,ar(this,aA),ap(this,aC));this.commit()};S.zoomIn=function(aA,az){this.setZoom(Math.round(this.getZoom()+1),aA,az)},S.zoomOut=function(aA,az){this.setZoom(Math.round(this.getZoom()-1),aA,az)},S.getLocation=function(aA,aB){var az=this._pendMapState;aA=ar(this,aA);aB=ap(this,aB);return l.xy(az.getGlbX(aA,aB),az.getGlbY(aB,aB))};S.setLocation=function(az,aA,aB){az=l.from(az);this.begin();this._pendMapState.setGlbXY(az._x,az._y,ar(this,aA),ap(this,aB));this.commit()};S._invalidate=function(aC){var aB=this.mapState,az=this._surfaces,aA,aD;for(aD=0;aD<az.length;aD++){aA=az[aD];aA.style.left=(-aB.x)+"px";aA.style.top=(-aB.y)+"px"}if(aC){this._notifyReset()}else{this._notifyPosition()}};S._each=function(aD,aB){var aC=this._layers,aA=this._surfaces,az,aF,aE;for(aF=0;aF<aC.length;aF++){az=aC[aF];for(var aE=az.firstChild;aE;aE=aE.nextSibling){if(aE.nodeType!==1||aE.nmt==="surface"){continue}aB.call(this,aE)}}if(aD){for(aF=0;aF<aA.length;aF++){az=aA[aF];for(var aE=az.firstChild;aE;aE=aE.nextSibling){if(aE.nodeType!==1){continue}aB.call(this,aE)}}}};S._notifyPosition=function(){this._each(false,function(aA){var az=aA.mapeer||r;if(ah(az.maposition)){az.maposition(this,aA)}})};S._notifyReset=function(){this._each(true,this._notifyResetSingle)};S._notifyResetSingle=function(aA){var az=aA.mapeer||r;if(ah(az.mareset)){az.mareset(this,aA)}};S.initialize=function(az){};S.eventToContainer=function(aE,aA){var az=this.elements[aA||"parent"],aB=az,aD={x:aE.clientX,y:aE.clientY},aC;do{aC=parseInt(Q(aB,"zoom"))||1;aD.x-=aB.offsetLeft;aD.y-=aB.offsetTop;aD.x/=aC;aD.y/=aC}while(aB=aB.offsetParent);aD.x+=window.pageXOffset||0;aD.y+=window.pageYOffset||0;return aD};function ax(aA,az){if(aq(az)){return az}if(!az||!ah(az.getElement)){throw new Error("Object "+az+" is not a valid Attachment")}return az.getElement(aA)}S.attach=function(aB,az){if(!az){az={}}var aA=az.layer,aD=az.unmanaged,aE,aF=ax(this,aB);if(aB!==aF){if(!aA){aA=aB.defaultLayer}aD=aB.unmanaged}aF.style.position="absolute";aE=aD?this.layer(aA):this.surface(aA);if(aF.parentNode===aE){return}try{aE.appendChild(aF)}catch(aC){C(aF)}this._notifyResetSingle(aF);return aF};S.detach=function(az){var aA=ax(this,az);if(aA.parentNode){aA.parentNode.removeChild(aA)}};S.collect=function(){};S.update=function(aB){var aA=ax(this,aB),az=aA.parentNode;if(!az||!az.nmt){this.attach(aB)}else{this._notifyResetSingle(aA)}return aA};S.setSize=function(aB,az){var aD=this.elements.parent,aA=this.getLocation(),aC=this._pendMapState;this.begin();if(arguments.length<2){aD.style.width="";aD.style.height="";aB=aD.clientWidth;az=aD.clientHeight}aD.style.width=aB+"px";aD.style.height=az+"px";aC.w=aB;aC.h=az;this.setLocation(aA);this.commit()};S.moveBy=function(aB,az){var aA=this.getLocation(aB,-az);this.setLocation(aA,0,0)};S.globalToXY=function(aC){var aD=this.mapState,az=aD.prj,aA,aB;aC=l.from(aC);aA=aD.prjToDspX(az.fwdX(aC._x));aB=aD.prjToDspY(az.fwdY(aC._y));return(isNaN(aA)||isNaN(aB))?null:new l(aA,aB)};function y(aA){var az=aA.geo;if(!az){az={};if(isNaN(az.latitude=Number(aA.getAttribute("latitude")||"NaN"))){return null}if(isNaN(az.longitude=Number(aA.getAttribute("longitude")||"NaN"))){return null}az.xoffset=Number(aA.getAttribute("xoffset")||"NaN");az.yoffset=Number(aA.getAttribute("yoffset")||"NaN")}return az}var r={mareset:function(aC,az){var aD=y(az),aE,aA,aB;if(aD){aE=aC.globalToXY(aD);if(aE){aA=aE.x()+Number(aD.xoffset||0);aB=aE.y()+Number(aD.yoffset||0);az.style.left=(aA)+"px";az.style.top=(aB)+"px";az.style.display="block";return}}az.style.display="none"}};K.MapSurface=F;K.DefaultAttachmentPeer=r;function B(aA){if(!aA){aA={}}var aB=this.peer=new G();var aC=aB.sel=new O(aA);var aD=Number(aA.pixelRatio);if(!aD&&aA.autoPixelRatio){aD=window.devicePixelRatio}aC.pixelRatio=aB.pixelRatio=this.pixelRatio=aD||1;var az=this.element=document.createElement("div");az.style.position="absolute";az.style.left="0px";az.style.top="0px";if(aD){az.style.zoom=(1/aD)}az.mapeer=aB;az.setAttribute("tilesrc",aC.toString())}B.prototype={unmanaged:true,defaultLayer:"map",getElement:function(az){this.owner=az;return this.element}};function G(){this.lockedState=null;this.current=new b();this.old=new b();this.transition=new b()}G.prototype={maposition:function(az,aA){this.mareset(az,aA)},loadPendingTiles:function(aG){var aB=this.transition,aF=this.current,aI=this.pixelRatio,az=aI*(aG.w-1),aJ=aI*(aG.h-1),aC,aE,aA,aD,aH=[];aB.clear();aC=this.sel.select(aG.prj,aG.res/aI,aG.getPrjX(0,0),aG.getPrjY(0,0),aG.getPrjX(az,aJ),aG.getPrjY(az,aJ));for(aE=0;aE<aC.length;aE++){aA=aC[aE];aD=aF.move(aA,aB);if(!aD){aD=new ak(this.sel,aA);aB.add(aD);aH.push(aD);X(aG,aD,aI)}}c(aH,aI*aG.w/2,aI*aG.h/2);for(aE=0;aE<aH.length;aE++){aD=aH[aE];aD.loading=true;this.sel.loadTile(aD,null,true)}},mareset:function(aM,aE){var aG=this.current,aB=this.transition,aJ=this.old,aI=aM.mapState,aH=this.lockedState,aL=this.pixelRatio,az=aL*(aI.w-1),aN=aL*(aI.h-1),aC,aF,aA,aD,aK=[];if(aH!==aI.finalState){aH=this.lockedState=aI.finalState;if(aH){this.loadPendingTiles(aH)}}aG.resetMarks();aC=this.sel.select(aI.prj,aI.res/aL,aI.getPrjX(0,0),aI.getPrjY(0,0),aI.getPrjX(az,aN),aI.getPrjY(az,aN));for(aF=0;aF<aC.length;aF++){aA=aC[aF];aD=aG.get(aA)||aB.move(aA,aG);if(!aH&&aD&&aD.temporary){aD=null}if(!aD){aD=new ak(this.sel,aA);if(aH){aD.temporary=true}aG.add(aD)}aD.mark=true;X(aI,aD,aL);if(!aD.parent){aK.push(aD)}}if(aK.length>0){aG.sweep(aJ,function(aO){X(aI,aO,aL)})}c(aK,aL*aI.w/2,aL*aI.h/2);for(aF=0;aF<aK.length;aF++){aD=aK[aF];if(!aD.loading&&!aD.temporary){aD.loading=true;this.sel.loadTile(aD)}if(!aD.drawable){aD.generatePreview(aJ)}aD.attach(aE)}aG.sweep();aJ.sweep();if(!aH){aB.clear()}}};function c(az,aA,aB){az.sort(function(aE,aF){var aC=Math.abs(aE.left+aE.width/2-aA)+Math.abs(aE.top+aE.height/2-aB),aD=Math.abs(aF.left+aF.width/2-aA)+Math.abs(aF.top+aF.height/2-aB);return aC-aD})}function X(aG,aF,aB){var az=aF.sel.tileSize,aC=aF.tileKey,aA=aB*Math.ceil(az*aC.res/aG.res),aD=aB*Math.floor(aG.prjToDspX(aC.scaledX*aC.res)-aG.x),aE=aB*Math.floor(aG.prjToDspY(aC.scaledY*aC.res)-aG.y);aF.setBounds(aD,aE,aA,aA)}function O(az){az=az||{};this.tileSize=az.tileSize||256;this.srcSpec=az.tileSrc||"";this.pending={}}O.prototype={toString:function(){return this.srcSpec},_sched:function(aB){var az=this,aC=aB.tile.tileKey.id,aA=aB.img;aA.onload=function(){aB.loaded=true;aD();if(aB.tile){aB.tile.update(aA)}};aA.onerror=function(){aD()};function aD(){aB.time=an()-aB.time;delete az.pending[aC]}az.pending[aC]=aB;aA.src=aB.src},loadTile:function(aA){var az={tile:aA,src:this.resolveSrc(aA.tileKey),img:document.createElement("img"),loaded:false,time:an()};this._sched(az)},destroyTile:function(aA){var aB=aA.tileKey.id;var az=this.pending[aB];if(az&&az.tile===aA){delete this.pending[aB];az.img.src="data:image/png,"}},destroyDrawable:function(az,aA){},resolveSrc:function(az){var aA=this;return aA.srcSpec.replace(/\$\{([A-Za-z]+)(\:([^\}]*))?\}/g,function(aC,aD,aB,aE){if(aD==="quadkey"){return v(az.tileX,az.tileY,az.level)}else{if(aD==="modulo"){aE=aE.split(/\,/);return aE[az.tileX%aE.length]}else{if(aD==="pixelRatio"){return aA.pixelRatio||1}else{return az[aD]}}}})},select:function(aA,aJ,aC,aR,aE,aS){var aL=this.tileSize,aK=aA.PRJ_EXTENT,aP=aA.XINVERTED,aQ=aA.YINVERTED,aT=Math.round(aA.toLevel(aJ)),aN=aA.fromLevel(aT),aF,aG;aC/=aN;aR/=aN;aE/=aN;aS/=aN;if(aQ){aG=aK.maxy/aN;aR=aG-aR;aS=aG-aS}else{aG=aK.miny/aN;aR=aR-aG;aS=aS-aG}if(aP){aF=aK.maxx/aN;aC=aF-aC;aE=aF-aE}else{aF=aK.minx/aN;aC=aC-aF;aE=aE-aF}var aB=Math.floor(Math.min(aC,aE)/aL),aD=Math.floor(Math.min(aR,aS)/aL),aU=Math.floor(Math.max(aC,aE)/aL),aV=Math.floor(Math.max(aS,aS)/aL),aH,aI,aM,aO,az=[];for(aI=aD;aI<=aV;aI++){if(aQ){aO=aG-aI*aL}else{aO=aG+aI*aL}for(aH=aB;aH<=aU;aH++){if(aP){aM=aF-aH*aL}else{aM=aF+aH*aL}az.push(new E(aT,aH,aI,aN,aM,aO,aL))}}return az}};function E(aB,aC,aD,aF,aE,az,aA){this.id=aC+","+aD+"@"+aB;this.level=aB;this.tileX=aC;this.tileY=aD;this.res=aF;this.scaledX=aE;this.scaledY=az;this.size=aA}function ak(aA,az){this.sel=aA;this.tileKey=az;this.drawable=null;this.parent=null;this.left=null;this.top=null;this.width=null;this.height=null;this.mark=false;this.temporary=false;this.loading=false}ak.prototype={_commitBounds:function(az){az.style.position="absolute";az.style.left=this.left+"px";az.style.top=this.top+"px";az.style.width=this.width+"px";az.style.height=this.height+"px"},update:function(aA){var az=this.drawable;this.drawable=aA;aA.setAttribute("tileid",this.tileKey.id);if(this.parent){this._commitBounds(aA);if(az){this.parent.replaceChild(aA,az)}else{this.parent.appendChild(aA)}}if(az){this.sel.destroyDrawable(this,az)}},setBounds:function(aB,aC,aD,aA){var az=this.drawable;this.left=parseInt(aB);this.top=parseInt(aC);this.width=parseInt(aD);this.height=parseInt(aA);if(az){this._commitBounds(az)}},attach:function(az){var aA=this.drawable;if(this.parent&&az!==this.parent){this.detach()}this.parent=az;if(aA){this._commitBounds(aA);if(!aA.parentNode){az.appendChild(aA)}}},detach:function(){var az=this.drawable;this.parent=null;if(az&&az.parentNode){az.parentNode.removeChild(az)}},dispose:function(){this.detach();if(this.drawable){this.sel.destroyDrawable(this,this.drawable);this.drawable=null}this.sel.destroyTile(this)},generatePreview:function(az){var aA=this,aB=null;az.intersect(aA,function(aC){if(!aB){try{aB=new ac(aA)}catch(aD){}}if(aB){aB.add(aC)}});if(aB){aA.update(aB.drawable)}}};function ac(aB){var az=document.createElement("canvas"),aA;az.width=aB.width;az.height=aB.height;aA=az.getContext("2d");this.drawable=az;this.add=function(aO){var aC=aO.left-aB.left,aD=aO.top-aB.top,aG=0,aH=0,aE,aJ,aL,aF=aO.width,aK=aO.height,aM=aO.tileKey.size/aO.width,aN=aO.tileKey.size/aO.height;if(aC<0){aG=-aC;aC=0;aF-=aG}if(aD<0){aH=-aD;aD=0;aK-=aH}aL=aC+aF-aB.width;if(aL>=0){aF-=aL}aL=aD+aK-aB.height;if(aL>=0){aK-=aL}aG*=aM;aH*=aN;aE=aF*aM;aJ=aK*aN;try{aA.drawImage(aO.drawable,aG,aH,aE,aJ,aC,aD,aF,aK)}catch(aI){}}}function b(){this._c={}}b.prototype={each:function(aB){var az=this._c,aA;for(aA in az){if(az.hasOwnProperty(aA)){aB(az[aA])}}},resetMarks:function(){this.each(function(az){az.mark=false})},get:function(az){return this._c[az.id]},add:function(az){var aB=az.tileKey.id,aC=this._c;var aA=aC[aB];if(aA){aA.dispose()}aC[aB]=az},move:function(aD,az){var aB=aD.id,aC=this._c,aA=aC[aB];if(aA){delete aC[aB];az.add(aA)}return aA},sweep:function(aE,aA){var aB=this._c,aD=[],az,aC;for(az in aB){if(aB.hasOwnProperty(az)){aC=aB[az];if(!aC.mark){if(aE){aE.add(aC)}else{aC.dispose()}if(aA){aA(aC)}aD.push(az)}}}for(az=0;az<aD.length;az++){delete aB[aD[az]]}},clear:function(){var aB=this._c,az=[],aA,aC;for(aA in aB){if(aB.hasOwnProperty(aA)){aC=aB[aA];aC.dispose()}}this._c={}},intersect:function(aC,aA){var aE=this._c,aH,aG,az=aC.left,aB=aC.top,aD=az+aC.width,aF=aB+aC.height;for(aH in aE){if(aE.hasOwnProperty(aH)){aG=aE[aH];if(aG.drawable&&!(aG.left>=aD||(aG.left+aG.width)<az||aG.top>=aF||(aG.top+aG.height)<aB)){aA(aG)}}}}};nanomaps.CartesianTileSelector=O;nanomaps.TileLayer=B;var s=0,ab=1,A=2,D=280,au=10,ae=1000,w=280;function x(az){this.type=az;this.handled=false}function p(aB){function az(aV){aB.dispatchMotionEvent(aV)}var aH,aN;function aU(aW){var aV=aB.elements.document;if(aW&&!aN){I(aV,"mouseup",aO);I(aV,"mousemove",aO);aN=true}else{if(!aW&&aN){e(aV,"mouseup",aO);e(aV,"mousemove",aO);aN=false}}}function aI(aV,aW){aL();aH={b:aV.button,s:s,cnt:0,cs:aW,cl:aW,t:0,ti:null}}function aK(){setTimeout(function(){if(aH&&aH.s===A){aH.ti=null;aD();aL()}},D)}function aM(){if(aH&&aH.ti){clearTimeout(aH.ti)}}function aD(){var aV=new x("click");aV.button=aH.b;aV.count=aH.cnt;aV.x=aH.cs.x;aV.y=aH.cs.y;az(aV)}function aL(){aM();aH=null}function aO(aX){if(!n(aX)){return}m(aX);var aW=aB.eventToContainer(aX),aV;switch(aX.type){case"mousemove":if(aH.s===s||aH.s===ab){aH.s=ab;aV=new x("drag");aV.button=aH.b;aV.x=aW.x;aV.y=aW.y;if(!aH.cl){aH.cl=aH.cs}aV.deltaX=aH.cl.x-aW.x;aV.deltaY=aH.cl.y-aW.y;aH.cl=aW;az(aV)}break;case"mousedown":if(aH&&aH.s===A){if((an()-aH.t)>D){aD();aI(aX,aW)}else{aH.s=s;aM()}}else{aI(aX,aW)}aU(true);break;case"mouseup":aU(false);aH.cnt++;if(aH.s===s){aH.s=A;aH.t=an();aK()}else{aL()}break}}function aF(aX){m(aX);aL();aU(false);var aZ,aW=10,aV=aB.eventToContainer(aX),aY=new x("scroll");if(aX.wheelDelta){aZ=aX.wheelDelta/120}else{if(aX.delta){aZ=-aX.delta/3}else{aZ=-aX.detail/3}}aZ/=aW;if(aZ>2){aZ=2}else{if(aZ<-2){aZ=-2}}aY.x=aV.x;aY.y=aV.y;aY.deltaZoom=aZ/aW;az(aY)}var aT;function aJ(){aP();aT.ti=setTimeout(function(){aT.ti=null;aA();aR()},w)}function aG(){aP();aT.ti=setTimeout(function(){if(!aT||aT.s!==s||aT.t.length!==1){return}var aV=new x("longtap");aV.button=0;aV.x=aT.t[0].x;aV.y=aT.t[0].y;aV.count=1;az(aV);if(aV.handled){aR()}},ae)}function aP(){if(aT){if(aT.ti){clearTimeout(aT.ti)}aT.ti=null}}function aR(){aP();aT=null}function aA(){var aV=new x("click");aV.button=0;aV.count=aT.cnt;aV.x=aT.tapX;aV.y=aT.tapY;az(aV)}function aS(aV){var aW=[];if(aV){for(i=0;i<aV.length;i++){touch=aV[i];aW.push(aB.eventToContainer(touch))}}return aW}function aC(aW,aX){var aV=new x("drag");aV.button=0;aV.x=aW.x;aV.y=aW.y;aV.deltaX=aX.x-aW.x;aV.deltaY=aX.y-aW.y;az(aV)}function aE(a0,a2,aY,aZ){var a4=new x("pinch"),aV=(a0.x+a2.x)/2,aX=(a0.y+a2.y)/2,a1=(aY.x+aZ.x)/2,a3=(aY.y+aZ.y)/2,a6=a0.x-a2.x,a7=a0.y-a2.y,a8=aY.x-aZ.x,a9=aY.y-aZ.y,a5=Math.sqrt(a6*a6+a7*a7),aW=Math.sqrt(a8*a8+a9*a9);a4.button=0;a4.x=aV;a4.y=aX;a4.deltaX=a1-aV;a4.deltaY=a3-aX;a4.deltaZoom=Math.log(a5/aW)*1.5;az(a4)}function aQ(aX){var aV=aX.type,aW;m(aX);aW=aS(aX.touches);if(aV==="touchstart"){if(aT&&aT.s===A){if((an()-aT.te)>w){touchDispatch();aR()}else{if(aW.length===1){aT.s=s;aT.t=aW;aP();return}}}if(!aT){aT={s:s,t:aW,mt:false,te:0,ts:an(),ti:null,cnt:0};aG()}else{if(aW.length>1){aT.mt=true}aT.t=aW}return}if(!aT){return}switch(aX.type){case"touchmove":if(aW.length===1){if(aT.s===ab||Math.abs(aW[0].x-aT.t[0].x)>au||Math.abs(aW[0].y-aT.t[0].y)>au){aP();if(aT.s===A){touchDispatch();aT.cnt=0}aT.s=ab;aC(aW[0],aT.t[0]);aT.t=aW}}else{if(aW.length>1){aT.s=ab;aE(aW[0],aW[1],aT.t[0],aT.t[1]);aT.t=aW}}break;case"touchend":if(!aT.mt||aW.length===0){if(aT.s===s){aT.cnt++;aT.s=A;aT.tapX=aT.t[0].x;aT.tapY=aT.t[0].y;aT.te=an();aJ()}else{aR()}}else{aT.t=aW}break;case"touchcancel":aR();break}}this.listen=function(aW,a2,aX){var a0=aB.elements,aY=a0.event,aZ=a0.parent,aV=["touchstart","touchend","touchmove","touchcancel"],a1;if(aW){I(aY,"mousedown",aO)}if(aX){I(aY,"DOMMouseScroll",aF);I(aY,"mousewheel",aF)}if(a2&&aY.addEventListener){for(a1=0;a1<aV.length;a1++){aY.addEventListener(aV[a1],aQ,true)}}}}S.advise("initialize","after",function(aA){var az=new p(this);this.motionController=az;az.listen(!aA.noClick,!aA.noTouch,!aA.noWheel)});S.dispatchMotionEvent=function(az){var aA="motion."+az.type;this.emit(aA,az);if(!az.handled){this.handleMotionEvent(az)}};S.handleMotionEvent=function(az){if(az.handled){return}var aB=az.type,aA;if(aB==="drag"||aB==="pinch"){this.begin();this.moveBy(az.deltaX,-az.deltaY);aA=Number(az.deltaZoom);if(!isNaN(aA)){this.setZoom(this.getZoom()+aA,az.x,az.y)}this.commit();az.handled=true}else{if(aB==="scroll"){this.setZoom(this.getZoom()+az.deltaZoom,az.x,az.y);az.handled=true}else{if(aB==="click"&&az.count===2){this.begin();this.zoomIn(az.x,az.y);this.commit(true);az.handled=true}}}};function at(az,aA){if(aA[0]==="/"||aA.search(/^http(s)?\:/)>=0){return aA}if(az.match(/\/$/)){return az+aA}else{return az+"/"+aA}}function N(az){var aC=az.lastIndexOf("/"),aB=(aC>=0?az.substring(aC+1):az),aA=aB.match(/^([^_\-\.]+)/);return aA?aA[0]:az}function g(az){this.settings=new R(az);this.element=null;this.children=null}g.Settings={src:"orb_blue.png",baseUri:"",location:null,classSuffix:"",extraClasses:""};g.prototype={defaultLayer:"overlay",setLocation:function(aB){aB=l.from(aB);var aC=this.settings,az=this.element,aA=this.owner;aC.location=aB;if(az){if(aB){az.geo={latitude:aB.lat(),longitude:aB.lng()}}else{az.geo=null}if(aA&&az.parentNode){aA.update(az)}}},getElement:function(aA){this.owner=aA;if(this.element){return this.element}var aB=aA.elements.document,az=aB.createElement("div"),aC=aB.createElement("img");az.appendChild(aC);this.element=az;this.children={fg:aC};this._config();return az},_config:function(){var aB=this.settings,aE=aB.location,aD=this.element,aC=this.children.fg,aA,az;aA=at(aB.baseUri||"",aB.src||"");az=aB.classSuffix||N(aA);aD.className="nmim nmim-"+az+" "+aB.extraClasses;if(aE){aD.geo={latitude:aE.lat()||NaN,longitude:aE.lng()||NaN}}else{aD.geo=null}aC.className="nmim-fg";aC.setAttribute("src",aA||null)}};function R(az){if(az){for(var aA in az){if(az.hasOwnProperty(aA)){this[aA]=az[aA]}}}}R.prototype=g.Settings;K.ImgMarker=g;var aa="http://www.w3.org/2000/svg";function T(az){try{return document.createElementNS(aa,az)}catch(aB){var aA=document.createElement("svgdummy");if(!aA.style){aA.style={}}}}function av(az){az=this.settings=az||{};var aA=T("svg");aA.setAttribute("class",az.className||"");aA.mapeer=this;this.canvas=aA}av.prototype={unmanaged:false,defaultLayer:"shadow",getElement:function(az){this.owner=az;return this.canvas},mareset:function(az,aA){},invalidate:function(){var aA=this.owner,az=this.canvas;if(aA&&az.parentNode){this.mareset(aA,az)}}};af(av,M);function j(aA){av.call(this,aA);var az=T("ellipse");this.canvas.appendChild(az);this.ellipse=az}j.prototype={mareset:function(aN,aJ){var aK=this.ellipse,aH=this.settings,aL,aM,aA=aH.unit||"px",aO=aH.longitude,aC=aH.latitude,aI,aE,aF,aG,az,aB,aD;if("radius" in aH){aL=aM=a(aN,aH.radius||0,aA)}else{aL=a(aN,aH.rx||0,aA);aM=ay(aN,aH.ry||0,aA)}aI=am(aL*2+20);aE=am(aM*2+20);aF=Math.round(aI/2);aG=Math.round(aE/2);aK.setAttribute("cx",aF);aK.setAttribute("cy",aG);aK.setAttribute("rx",aL);aK.setAttribute("ry",aM);az=aN.globalToXY(aH);if(az){aB=az.x()-aF;aD=az.y()-aG;aJ.style.left=aB+"px";aJ.style.top=aD+"px";aJ.style.width=aI+"px";aJ.style.height=aE+"px";aJ.style.display="block"}else{aJ.style.display="none"}}};af(j,av);function am(az){az=Math.ceil(az);if((az%2)!==1){az++}return az}function a(aC,aB,az){var aA=aC.mapState.res;switch(az){case"px":return aB;case"m":return aB/aA;default:return 0}}function ay(aC,aB,az){var aA=aC.mapState.res;switch(az){case"px":return aB;case"m":return aB/aA;default:return 0}}K.SvgMarker=av;K.EllipseMarker=j;function al(az){if(!az){az={}}this.options=az;var aA=az.delegate||ag,aC,aB,aD;if(ah(aA)){aC=new aA(az)}else{aC=aA}this.delegate=aC;aD=this.element=aC.init();aD.mapeer=aC}al.prototype={defaultLayer:"foreground",getElement:function(az){var aA=this.owner;this.owner=az;return this.element},setLocation:function(aB,aC){var az=this.element,aA=this.owner;az.macoord=aB&&l.from(aB);az.maoffset=aC&&l.from(aC);if(aA&&az.parentNode){aA.update(this)}},getContent:function(){return this.delegate.getContent(this.element)}};function ag(az){this.cssPrefix=az.cssPrefix||"nmiw";this.margin=az.margin||25}ag.prototype={init:function(){var aB=this.cssPrefix,az=q(),aC=q(),aA=q();az.appendChild(aC);az.appendChild(aA);az.style.position="absolute";aA.style.position="absolute";az.className=aB;aC.className=aB+"-content";aA.className=aB+"-pointer";az._content=aC;az._pointer=aA;return az},mareset:function(aA,aE){var aB=aA.globalToXY(aE.macoord),az=aE.maoffset,aC,aD;if(aB){aC=aB.x();aD=aB.y();if(az){aC-=az.x();aD-=az.y()}aE.style.left=aC+"px";aE.style.top=aD+"px";aE.style.display="block"}else{aE.style.display="none"}if(!aE._layedOut){this.layout(aA,aE,false);aE._layedOut=true}},layout:function(aE,aC){aC.style.width="";var aF=this.margin,aA=aE.mapState.w-2*aF;if(aC.offsetWidth>aA){aC.style.width=(aA-aC.offsetWidth+aC.clientWidth)+"px"}var aG=aC.offsetWidth,aH=aC._pointer,aB=aG/2,az=parseInt(aC.style.left)+parseInt(aC.parentNode.style.left)-aB,aD;aD=az-aF;if(aD<0){aB+=aD}else{aD=(az+aG)-(aA-aF);if(aD>0){aB+=aD}}if(aB<aH.offsetWidth){aB=aH.offsetWidth}else{if(aB>(aG-aH.offsetWidth)){aB=aG-aH.offsetWidth}}aH.style.left=(aB)+"px";aC.style.marginLeft=(-aB)+"px";aC.style.marginTop=(-aC.offsetHeight-aH.offsetHeight)+"px"},getContent:function(az){return az._content}};K.InfoWindow=al;K.InfoWindowDelegate=ag})(window);
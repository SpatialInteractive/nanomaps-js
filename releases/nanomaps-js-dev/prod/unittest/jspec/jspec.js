(function(){JSpec={version:"4.3.2",assert:true,cache:{},suites:[],modules:[],allSuites:[],sharedBehaviors:[],matchers:{},stubbed:[],options:{},request:"XMLHttpRequest" in this?XMLHttpRequest:null,stats:{specs:0,assertions:0,failures:0,passes:0,specsFinished:0,suitesFinished:0},defaultContext:{an_instance_of:function(constructor){return{an_instance_of:constructor}},fixture:function(path){if(JSpec.cache[path]){return JSpec.cache[path]}return JSpec.cache[path]=JSpec.tryLoading(JSpec.options.fixturePath+"/"+path)||JSpec.tryLoading(JSpec.options.fixturePath+"/"+path+".html")},json_fixture:function(path){if(!JSpec.cache["json:"+path]){JSpec.cache["json:"+path]=JSpec.tryLoading(JSpec.options.fixturePath+"/"+path)||JSpec.tryLoading(JSpec.options.fixturePath+"/"+path+".json")}try{return eval("("+JSpec.cache["json:"+path]+")")}catch(e){throw'json_fixture("'+path+'"): '+e}}},reporters:{Server:function(results,options){var uri=options.uri||"http://"+window.location.host+"/results";JSpec.post(uri,{stats:JSpec.stats,options:options,results:map(results.allSuites,function(suite){if(suite.isExecutable()){return{description:suite.description,specs:map(suite.specs,function(spec){return{description:spec.description,message:!spec.passed()?spec.failure().message:null,status:spec.requiresImplementation()?"pending":spec.passed()?"pass":"fail",assertions:map(spec.assertions,function(assertion){return{passed:assertion.passed}})}})}}})});if("close" in main){main.close()}},DOM:function(results,options){var id=option("reportToId")||"jspec",report=document.getElementById(id),failuresOnly=option("failuresOnly"),classes=results.stats.failures?"has-failures":"";if(!report){throw"JSpec requires the element #"+id+" to output its reports"}function bodyContents(body){return JSpec.escape(JSpec.contentsOf(body)).replace(/^ */gm,function(a){return(new Array(Math.round(a.length/3))).join(" ")}).replace(/\r\n|\r|\n/gm,"<br/>")}report.innerHTML='<div id="jspec-report" class="'+classes+'"><div class="heading">         <span class="passes">Passes: <em>'+results.stats.passes+'</em></span>                        <span class="failures">Failures: <em>'+results.stats.failures+'</em></span>                  <span class="passes">Duration: <em>'+results.duration+'</em> ms</span>                  </div><table class="suites">'+map(results.allSuites,function(suite){var displaySuite=failuresOnly?suite.ran&&!suite.passed():suite.ran;if(displaySuite&&suite.isExecutable()){return'<tr class="description"><td colspan="2">'+escape(suite.description)+"</td></tr>"+map(suite.specs,function(i,spec){return'<tr class="'+(i%2?"odd":"even")+'">'+(spec.requiresImplementation()?'<td class="requires-implementation" colspan="2">'+escape(spec.description)+"</td>":(spec.passed()&&!failuresOnly)?'<td class="pass">'+escape(spec.description)+"</td><td>"+spec.assertionsGraph()+"</td>":!spec.passed()?'<td class="fail">'+escape(spec.description)+map(spec.failures(),function(a){return"<em>"+escape(a.message)+"</em>"}).join("")+"</td><td>"+spec.assertionsGraph()+"</td>":"")+'<tr class="body"><td colspan="2"><pre>'+bodyContents(spec.body)+"</pre></td></tr>"}).join("")+"</tr>"}}).join("")+"</table></div>"},Terminal:function(results,options){var failuresOnly=option("failuresOnly");print(color("\n Passes: ","bold")+color(results.stats.passes,"green")+color(" Failures: ","bold")+color(results.stats.failures,"red")+color(" Duration: ","bold")+color(results.duration,"green")+" ms \n");function indent(string){return string.replace(/^(.)/gm,"  $1")}each(results.allSuites,function(suite){var displaySuite=failuresOnly?suite.ran&&!suite.passed():suite.ran;if(displaySuite&&suite.isExecutable()){print(color(" "+suite.description,"bold"));each(suite.specs,function(spec){var assertionsGraph=inject(spec.assertions,"",function(graph,assertion){return graph+color(".",assertion.passed?"green":"red")});if(spec.requiresImplementation()){print(color("  "+spec.description,"blue")+assertionsGraph)}else{if(spec.passed()&&!failuresOnly){print(color("  "+spec.description,"green")+assertionsGraph)}else{if(!spec.passed()){print(color("  "+spec.description,"red")+assertionsGraph+"\n"+indent(map(spec.failures(),function(a){return a.message}).join("\n"))+"\n")}}}});print("")}});quit(results.stats.failures)}},Assertion:function(matcher,actual,expected,negate){extend(this,{message:"",passed:false,actual:actual,negate:negate,matcher:matcher,expected:expected,report:function(){if(JSpec.assert){this.passed?JSpec.stats.passes++:JSpec.stats.failures++}return this},run:function(){expected.unshift(actual);this.result=matcher.match.apply(this,expected);this.passed=negate?!this.result:this.result;if(!this.passed){this.message=matcher.message.call(this,actual,expected,negate,matcher.name)}return this}})},ProxyAssertion:function(object,method,times,negate){var self=this,old=object[method];object[method]=function(){var args=toArray(arguments),result=old.apply(object,args);self.calls.push({args:args,result:result});return result};this.times={once:1,twice:2}[times]||times||1;extend(this,{calls:[],message:"",defer:true,passed:false,negate:negate,object:object,method:method,and_return:function(result){this.expectedResult=result;return this},with_args:function(){this.expectedArgs=toArray(arguments);return this},anyResultsFail:function(){return any(this.calls,function(call){return self.expectedResult.an_instance_of?call.result.constructor!=self.expectedResult.an_instance_of:!equal(self.expectedResult,call.result)})},anyResultsPass:function(){return any(this.calls,function(call){return self.expectedResult.an_instance_of?call.result.constructor==self.expectedResult.an_instance_of:equal(self.expectedResult,call.result)})},passingResult:function(){return this.anyResultsPass().result},failingResult:function(){return this.anyResultsFail().result},anyArgsFail:function(){return any(this.calls,function(call){return any(self.expectedArgs,function(i,arg){if(arg==null){return call.args[i]==null}return arg.an_instance_of?call.args[i].constructor!=arg.an_instance_of:!equal(arg,call.args[i])})})},anyArgsPass:function(){return any(this.calls,function(call){return any(self.expectedArgs,function(i,arg){return arg.an_instance_of?call.args[i].constructor==arg.an_instance_of:equal(arg,call.args[i])})})},passingArgs:function(){return this.anyArgsPass().args},failingArgs:function(){return this.anyArgsFail().args},report:function(){if(JSpec.assert){this.passed?++JSpec.stats.passes:++JSpec.stats.failures}return this},run:function(){var methodString="expected "+object.toString()+"."+method+"()"+(negate?" not":"");function times(n){return n>2?n+" times":{1:"once",2:"twice"}[n]}if(this.expectedResult!=null&&(negate?this.anyResultsPass():this.anyResultsFail())){this.message=methodString+" to return "+puts(this.expectedResult)+" but "+(negate?"it did":"got "+puts(this.failingResult()))}if(this.expectedArgs&&(negate?!this.expectedResult&&this.anyArgsPass():this.anyArgsFail())){this.message=methodString+" to be called with "+puts.apply(this,this.expectedArgs)+" but was"+(negate?"":" called with "+puts.apply(this,this.failingArgs()))}if(negate?!this.expectedResult&&!this.expectedArgs&&this.calls.length>=this.times:this.calls.length!=this.times){this.message=methodString+" to be called "+times(this.times)+", but "+(this.calls.length==0?" was not called":" was called "+times(this.calls.length))}if(!this.message.length){this.passed=true}return this}})},Suite:function(description,body,isShared){var self=this;extend(this,{body:body,description:description,suites:[],sharedBehaviors:[],specs:[],ran:false,shared:isShared,hooks:{before:[],after:[],before_each:[],after_each:[],before_nested:[],after_nested:[]},addSpec:function(description,body){var spec=new JSpec.Spec(description,body);this.specs.push(spec);JSpec.stats.specs++;spec.suite=this},addBefore:function(options,body){body.options=options||{};this.befores.push(body)},addAfter:function(options,body){body.options=options||{};this.afters.unshift(body)},addHook:function(hook,body){this.hooks[hook].push(body)},addSuite:function(description,body,isShared){var suite=new JSpec.Suite(description,body,isShared);JSpec.allSuites.push(suite);suite.name=suite.description;suite.description=this.description+" "+suite.description;this.suites.push(suite);suite.suite=this},hook:function(hook){if(hook!="before"&&hook!="after"){if(this.suite){this.suite.hook(hook)}}each(this.hooks[hook],function(body){JSpec.evalBody(body,"Error in hook '"+hook+"', suite '"+self.description+"': ")})},hasSuites:function(){return this.suites.length},hasSpecs:function(){return this.specs.length},passed:function(){return !any(this.specs,function(spec){return !spec.passed()})},isShared:function(){return this.shared},isExecutable:function(){return !this.isShared()&&this.hasSpecs()}})},Spec:function(description,body){extend(this,{body:body,description:description,assertions:[],pass:function(message){this.assertions.push({passed:true,message:message});if(JSpec.assert){++JSpec.stats.passes}},fail:function(message){this.assertions.push({passed:false,message:message});if(JSpec.assert){++JSpec.stats.failures}},runDeferredAssertions:function(){each(this.assertions,function(assertion){if(assertion.defer){assertion.run().report(),hook("afterAssertion",assertion)}})},failure:function(){return find(this.assertions,function(assertion){return !assertion.passed})},failures:function(){return select(this.assertions,function(assertion){return !assertion.passed})},passed:function(){return !this.failure()},requiresImplementation:function(){return this.assertions.length==0},assertionsGraph:function(){return map(this.assertions,function(assertion){return'<span class="assertion '+(assertion.passed?"passed":"failed")+'"></span>'}).join("")}})},Module:function(methods){extend(this,methods)},JSON:{meta:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},escapable:/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,encode:function(object){var self=this;if(object==undefined||object==null){return"null"}if(object===true){return"true"}if(object===false){return"false"}switch(typeof object){case"number":return object;case"string":return this.escapable.test(object)?'"'+object.replace(this.escapable,function(a){return typeof self.meta[a]==="string"?self.meta[a]:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+object+'"';case"object":if(object.constructor==Array){return"["+map(object,function(val){return self.encode(val)}).join(", ")+"]"}else{if(object){return"{"+map(object,function(key,val){return self.encode(key)+":"+self.encode(val)}).join(", ")+"}"}}}return"null"}},DSLs:{snake:{expect:function(actual){return JSpec.expect(actual)},describe:function(description,body){return JSpec.currentSuite.addSuite(description,body,false)},it:function(description,body){return JSpec.currentSuite.addSpec(description,body)},before:function(body){return JSpec.currentSuite.addHook("before",body)},after:function(body){return JSpec.currentSuite.addHook("after",body)},before_each:function(body){return JSpec.currentSuite.addHook("before_each",body)},after_each:function(body){return JSpec.currentSuite.addHook("after_each",body)},before_nested:function(body){return JSpec.currentSuite.addHook("before_nested",body)},after_nested:function(body){return JSpec.currentSuite.addhook("after_nested",body)},shared_behaviors_for:function(description,body){return JSpec.currentSuite.addSuite(description,body,true)},should_behave_like:function(description){return JSpec.shareBehaviorsOf(description)}}},haveStopped:function(value){return value==="stop"},include:function(object){var module=object.constructor==JSpec.Module?object:new JSpec.Module(object);this.modules.push(module);if("init" in module){module.init()}if("utilities" in module){extend(this.defaultContext,module.utilities)}if("matchers" in module){this.addMatchers(module.matchers)}if("reporters" in module){extend(this.reporters,module.reporters)}if("DSLs" in module){each(module.DSLs,function(name,methods){JSpec.DSLs[name]=JSpec.DSLs[name]||{};extend(JSpec.DSLs[name],methods)})}return this},hook:function(name,args){args=toArray(arguments,1);return inject(JSpec.modules,[],function(results,module){if(typeof module[name]=="function"){results.push(JSpec.evalHook(module,name,args))}})},evalHook:function(module,name,args){hook("evaluatingHookBody",module,name);return module[name].apply(module,args)},hookImmutable:function(name,arg){return inject(JSpec.modules,arg,function(result,module){if(typeof module[name]=="function"){return JSpec.evalHook(module,name,[result])}})},findSharedBehavior:function(description){var behavior;return(behavior=JSpec.findLocalSharedBehavior(description))?behavior:JSpec.findGlobalSharedBehavior(description)},findLocalSharedBehavior:function(description){var behavior,currentSuite=JSpec.currentSuite.suite;while(currentSuite){if(behavior=find(currentSuite.suites,JSpec.suiteDescriptionPredicate(description))){return behavior}else{currentSuite=currentSuite.suite}}},findGlobalSharedBehavior:function(description){return find(JSpec.suites,JSpec.suiteDescriptionPredicate(description))},suiteDescriptionPredicate:function(description){return function(suite){return suite.name===description||suite.description===description}},shareBehaviorsOf:function(description){var suite=JSpec.findSharedBehavior(description);if(suite){JSpec.evalBody(suite.body)}else{throw new Error("failed to find shared behaviors named `"+description+"'")}},toArray:function(arguments,offset){return Array.prototype.slice.call(arguments,offset||0)},color:function(string,color){if(option("disableColors")){return string}else{return"\u001B["+{bold:1,black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37}[color]+"m"+string+"\u001B[0m"}},defaultMatcherMessage:function(actual,expected,negate,name){return"expected "+puts(actual)+" to "+(negate?"not ":"")+name.replace(/_/g," ")+" "+(expected.length>1?puts.apply(this,expected.slice(1)):"")},normalizeMatcherMessage:function(matcher){if(typeof matcher.message!="function"){matcher.message=this.defaultMatcherMessage}return matcher},normalizeMatcherBody:function(body){var captures;switch(body.constructor){case String:if(captures=body.match(/^alias (\w+)/)){return JSpec.matchers[last(captures)]}if(body.length<4){body="actual "+body+" expected"}return{match:function(actual,expected){return eval(body)}};case Function:return{match:body};default:return body}},option:function(key){return(value=query(key))!==null?value:JSpec.options[key]||null},equal:function(a,b){if(typeof a!=typeof b){return}if(a===b){return true}if(a instanceof RegExp){return a.toString()===b.toString()}if(a instanceof Date){return Number(a)===Number(b)}if(typeof a!="object"){return}if(a.length!==undefined){if(a.length!==b.length){return}else{for(var i=0,len=a.length;i<len;++i){if(!equal(a[i],b[i])){return}}}}for(var key in a){if(!equal(a[key],b[key])){return}}return true},last:function(array){return array[array.length-1]},puts:function(object){if(arguments.length>1){return map(toArray(arguments),function(arg){return puts(arg)}).join(", ")}if(object===undefined){return"undefined"}if(object===null){return"null"}if(object===true){return"true"}if(object===false){return"false"}if(object.an_instance_of){return"an instance of "+object.an_instance_of.name}if(object.jquery&&object.selector.length>0){return"selector "+puts(object.selector)}if(object.jquery){return object.get(0).outerHTML}if(object.nodeName){return object.outerHTML}switch(object.constructor){case Function:return object.name||object;case String:return'"'+object.replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\t/g,"\\t")+'"';case Array:return inject(object,"[",function(b,v){return b+", "+puts(v)}).replace("[,","[")+" ]";case Object:object.__hit__=true;return inject(object,"{",function(b,k,v){if(k=="__hit__"){return b}return b+", "+k+": "+(v&&v.__hit__?"<circular reference>":puts(v))}).replace("{,","{")+" }";default:return object.toString()}},parseXML:function(text){var xmlDoc;if(window.DOMParser){xmlDoc=(new DOMParser()).parseFromString(text,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(text)}return xmlDoc},escape:function(html){return html.toString().replace(/&/gmi,"&amp;").replace(/"/gmi,"&quot;").replace(/>/gmi,"&gt;").replace(/</gmi,"&lt;")},does:function(actual,matcher,expected){var assertion=new JSpec.Assertion(JSpec.matchers[matcher],actual,toArray(arguments,2));return assertion.run().result},expect:function(actual){function assert(matcher,args,negate){var expected=toArray(args,1);matcher.negate=negate;var assertion=new JSpec.Assertion(matcher,actual,expected,negate);hook("beforeAssertion",assertion);if(matcher.defer){assertion.run()}else{JSpec.currentSpec.assertions.push(assertion.run().report()),hook("afterAssertion",assertion)}return assertion.result}function to(matcher){return assert(matcher,arguments,false)}function not_to(matcher){return assert(matcher,arguments,true)}return{to:to,should:to,not_to:not_to,should_not:not_to}},strip:function(string,chars){return string.replace(new RegExp("["+(chars||"\\s")+"]*$"),"").replace(new RegExp("^["+(chars||"\\s")+"]*"),"")},callIterator:function(callback,a,b){return callback.length==1?callback(b):callback(a,b)},extend:function(object,other){each(other,function(property,value){object[property]=value})},each:function(object,callback){if(object.constructor==Array){for(var i=0,len=object.length;i<len;++i){callIterator(callback,i,object[i])}}else{for(var key in object){if(object.hasOwnProperty(key)){callIterator(callback,key,object[key])}}}},inject:function(object,memo,callback){each(object,function(key,value){memo=(callback.length==2?callback(memo,value):callback(memo,key,value))||memo});return memo},destub:function(object,method){var captures;if(method){if(object["__prototype__"+method]){delete object[method]}else{object[method]=object["__original__"+method]}delete object["__prototype__"+method];delete object["__original____"+method]}else{if(object){for(var key in object){if(captures=key.match(/^(?:__prototype__|__original__)(.*)/)){destub(object,captures[1])}}}else{while(JSpec.stubbed.length){destub(JSpec.stubbed.shift())}}}},stub:function(object,method){hook("stubbing",object,method);JSpec.stubbed.push(object);var type=object.hasOwnProperty(method)?"__original__":"__prototype__";object[type+method]=object[method];object[method]=function(){};return{and_return:function(value){if(typeof value=="function"){object[method]=value}else{object[method]=function(){return value}}}}},map:function(object,callback){return inject(object,[],function(memo,key,value){memo.push(callIterator(callback,key,value))})},any:function(object,callback){return inject(object,null,function(state,key,value){if(state==undefined){return callIterator(callback,key,value)?value:state}})},select:function(object,callback){return inject(object,[],function(selected,key,value){if(callIterator(callback,key,value)){selected.push(value)}})},addMatchers:function(matchers){each(matchers,function(name,body){JSpec.addMatcher(name,body)})},addMatcher:function(name,body){hook("addingMatcher",name,body);if(name.indexOf(" ")!=-1){var matchers=name.split(/\s+/);var prefix=matchers.shift();each(matchers,function(name){JSpec.addMatcher(prefix+"_"+name,body(name))})}this.matchers[name]=this.normalizeMatcherMessage(this.normalizeMatcherBody(body));this.matchers[name].name=name},describe:function(description,body){var suite=new JSpec.Suite(description,body,false);hook("addingSuite",suite);this.allSuites.push(suite);this.suites.push(suite)},shared_behaviors_for:function(description,body){var suite=new JSpec.Suite(description,body,true);hook("addingSuite",suite);this.allSuites.push(suite);this.suites.push(suite)},contentsOf:function(body){return body.toString().match(/^[^\{]*{((.*\n*)*)}/m)[1]},evalBody:function(body,errorMessage){var dsl=this.DSL||this.DSLs.snake;var matchers=this.matchers;var context=this.context||this.defaultContext;var contents=this.contentsOf(body);hook("evaluatingBody",dsl,matchers,context,contents);with(dsl){with(context){with(matchers){eval(contents)}}}},preprocess:function(input){if(typeof input!="string"){return}input=hookImmutable("preprocessing",input);return input.replace(/\t/g,"  ").replace(/\r\n|\n|\r/g,"\n").split("__END__")[0].replace(/([\w\.]+)\.(stub|destub)\((.*?)\)$/gm,"$2($1, $3)").replace(/describe\s+(.*?)$/gm,"describe($1, function(){").replace(/shared_behaviors_for\s+(.*?)$/gm,"shared_behaviors_for($1, function(){").replace(/^\s+it\s+(.*?)$/gm," it($1, function(){").replace(/^ *(before_nested|after_nested|before_each|after_each|before|after)(?= |\n|$)/gm,'JSpec.currentSuite.addHook("$1", function(){').replace(/^\s*end(?=\s|$)/gm,"});").replace(/-\{/g,"function(){").replace(/(\d+)\.\.(\d+)/g,function(_,a,b){return range(a,b)}).replace(/\.should([_\.]not)?[_\.](\w+)(?: |;|$)(.*)$/gm,".should$1_$2($3)").replace(/([\/\s]*)(.+?)\.(should(?:[_\.]not)?)[_\.](\w+)\((.*)\)\s*;?$/gm,"$1 expect($2).$3($4, $5)").replace(/, \)/g,")").replace(/should\.not/g,"should_not")},range:function(start,end){var current=parseInt(start),end=parseInt(end),values=[current];if(end>current){while(++current<=end){values.push(current)}}else{while(--current>=end){values.push(current)}}return"["+values+"]"},report:function(){this.duration=Number(new Date)-this.start;hook("reporting",JSpec.options);new (JSpec.options.reporter||JSpec.reporters.DOM)(JSpec,JSpec.options)},run:function(options){if(any(hook("running"),haveStopped)){return this}if(options){extend(this.options,options)}this.start=Number(new Date);each(this.suites,function(suite){JSpec.runSuite(suite)});return this},runSuite:function(suite){if(!suite.isShared()){this.currentSuite=suite;this.evalBody(suite.body);suite.ran=true;hook("beforeSuite",suite),suite.hook("before"),suite.hook("before_nested");each(suite.specs,function(spec){hook("beforeSpec",spec);suite.hook("before_each");JSpec.runSpec(spec);hook("afterSpec",spec);suite.hook("after_each")});if(suite.hasSuites()){each(suite.suites,function(suite){JSpec.runSuite(suite)})}hook("afterSuite",suite),suite.hook("after_nested"),suite.hook("after");this.stats.suitesFinished++}},fail:function(message){JSpec.currentSpec.fail(message)},pass:function(message){JSpec.currentSpec.pass(message)},runSpec:function(spec){this.currentSpec=spec;try{this.evalBody(spec.body)}catch(e){fail(e)}spec.runDeferredAssertions();destub();this.stats.specsFinished++;this.stats.assertions+=spec.assertions.length},requires:function(dependency,message){hook("requiring",dependency,message);try{eval(dependency)}catch(e){throw"JSpec depends on "+dependency+" "+message}return this},query:function(key,queryString){var queryString=(queryString||(main.location?main.location.search:null)||"").substring(1);return inject(queryString.split("&"),null,function(value,pair){parts=pair.split("=");return parts[0]==key?parts[1].replace(/%20|\+/gmi," "):value})},post:function(uri,data){if(any(hook("posting",uri,data),haveStopped)){return}var request=this.xhr();request.open("POST",uri,false);request.setRequestHeader("Content-Type","application/json");request.send(JSpec.JSON.encode(data))},xhr:function(){return this.ieXhr()||new JSpec.request},ieXhr:function(){function object(str){try{return new ActiveXObject(str)}catch(e){}}return object("Msxml2.XMLHTTP.6.0")||object("Msxml2.XMLHTTP.3.0")||object("Msxml2.XMLHTTP")||object("Microsoft.XMLHTTP")},hasXhr:function(){return JSpec.request||"ActiveXObject" in main},tryLoading:function(file){try{return JSpec.load(file)}catch(e){}},load:function(file,callback){if(any(hook("loading",file),haveStopped)){return}if("readFile" in main){return readFile(file)}else{if(this.hasXhr()){var request=this.xhr();request.open("GET",file,false);request.send(null);if(request.readyState==4&&(request.status==0||request.status.toString().charAt(0)==2)){return request.responseText}}else{throw new Error("failed to load `"+file+"'")}}},exec:function(file){if(any(hook("executing",file),haveStopped)){return this}eval("with (JSpec){"+this.preprocess(this.load(file))+"}");return this}};if(typeof GLOBAL==="object"&&typeof exports==="object"){var fs=require("fs");quit=process.exit;print=require("sys").puts;readFile=function(file){return fs.readFileSync(file).toString("utf8")}}var main=this,find=JSpec.any,utils="haveStopped stub hookImmutable hook destub map any last pass fail range each option inject select                error escape extend puts query strip color does addMatchers callIterator toArray equal".split(/\s+/);while(utils.length){eval("var "+utils[0]+" = JSpec."+utils.shift())}if(!main.setTimeout){main.setTimeout=function(callback){callback()}}addMatchers({equal:"===",eql:"equal(actual, expected)",be:"alias equal",be_greater_than:">",be_less_than:"<",be_at_least:">=",be_at_most:"<=",be_a:"actual.constructor == expected",be_an:"alias be_a",be_an_instance_of:"actual instanceof expected",be_null:"actual == null",be_true:"actual == true",be_false:"actual == false",be_undefined:"typeof actual == 'undefined'",be_type:"typeof actual == expected",match:"typeof actual == 'string' ? actual.match(expected) : false",respond_to:"typeof actual[expected] == 'function'",have_length:"actual.length == expected",be_within:"actual >= expected[0] && actual <= last(expected)",have_length_within:"actual.length >= expected[0] && actual.length <= last(expected)",receive:{defer:true,match:function(actual,method,times){var proxy=new JSpec.ProxyAssertion(actual,method,times,this.negate);JSpec.currentSpec.assertions.push(proxy);return proxy}},be_empty:function(actual){if(actual.constructor==Object&&actual.length==undefined){for(var key in actual){return false}}return !actual.length},include:function(actual){for(var state=true,i=1;i<arguments.length;i++){var arg=arguments[i];switch(actual.constructor){case String:case Number:case RegExp:case Function:state=actual.toString().indexOf(arg)!==-1;break;case Object:state=arg in actual;break;case Array:state=any(actual,function(value){return equal(value,arg)});break}if(!state){return false}}return true},throw_error:{match:function(actual,expected,message){try{actual()}catch(e){this.e=e;var assert=function(arg){switch(arg.constructor){case RegExp:return arg.test(e.message||e.toString());case String:return arg==(e.message||e.toString());case Function:return e instanceof arg||e.name==arg.name}};return message?assert(expected)&&assert(message):expected?assert(expected):true}},message:function(actual,expected,negate){var message_for=function(i){if(expected[i]==undefined){return"exception"}switch(expected[i].constructor){case RegExp:return"exception matching "+puts(expected[i]);case String:return"exception of "+puts(expected[i]);case Function:return expected[i].name||"Error"}};var exception=message_for(1)+(expected[2]?" and "+message_for(2):"");return"expected "+exception+(negate?" not ":"")+" to be thrown, but "+(this.e?"got "+puts(this.e):"nothing was")}},have:function(actual,length,property){return actual[property]==null?false:actual[property].length==length},have_at_least:function(actual,length,property){return actual[property]==null?(length===0):actual[property].length>=length},have_at_most:function(actual,length,property){return actual[property]==null||actual[property].length<=length},have_within:function(actual,range,property){var length=actual[property]==undefined?0:actual[property].length;return length>=range.shift()&&length<=range.pop()},have_prop:function(actual,property,value){var actualVal=actual[property],actualType=typeof actualVal;return(actualType=="function"||actualType=="undefined")?false:typeof value==="undefined"||does(actual[property],"eql",value)},have_property:function(actual,property,value){var actualVal=actual[property],actualType=typeof actualVal;return(actualType=="function"||actualType=="undefined")?false:typeof value==="undefined"||value===actualVal}})})();
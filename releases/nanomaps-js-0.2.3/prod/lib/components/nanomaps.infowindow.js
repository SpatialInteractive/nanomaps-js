function InfoWindow(b){if(!b){b={}}this.options=b;var a=b.delegate||InfoWindowDelegate,d,e,c;if(isFunction(a)){d=new a(b)}else{d=a}this.delegate=d;c=this.element=d.init();c.mapeer=d}InfoWindow.prototype={defaultLayer:"foreground",getElement:function(b){var a=this.owner;this.owner=b;return this.element},setLocation:function(d,c){var b=this.element,a=this.owner;b.macoord=d&&Coordinate.from(d);b.maoffset=c&&Coordinate.from(c);if(a&&b.parentNode){a.update(this)}},getContent:function(){return this.delegate.getContent(this.element)}};function InfoWindowDelegate(a){this.cssPrefix=a.cssPrefix||"nmiw";this.margin=a.margin||25}InfoWindowDelegate.prototype={init:function(){var d=this.cssPrefix,b=div(),c=div(),a=div();b.appendChild(c);b.appendChild(a);b.style.position="absolute";a.style.position="absolute";b.className=d;c.className=d+"-content";a.className=d+"-pointer";b._content=c;b._pointer=a;return b},mareset:function(a,c){var f=a.globalToXY(c.macoord),b=c.maoffset,e,d;if(f){e=f.x();d=f.y();if(b){e-=b.x();d-=b.y()}c.style.left=e+"px";c.style.top=d+"px";c.style.display="block"}else{c.style.display="none"}if(!c._layedOut){this.layout(a,c,false);c._layedOut=true}},layout:function(d,f){f.style.width="";var c=this.margin,h=d.mapState.w-2*c;if(f.offsetWidth>h){f.style.width=(h-f.offsetWidth+f.clientWidth)+"px"}var b=f.offsetWidth,a=f._pointer,g=b/2,i=parseInt(f.style.left)+parseInt(f.parentNode.style.left)-g,e;e=i-c;if(e<0){g+=e}else{e=(i+b)-(h-c);if(e>0){g+=e}}if(g<a.offsetWidth){g=a.offsetWidth}else{if(g>(b-a.offsetWidth)){g=b-a.offsetWidth}}a.style.left=(g)+"px";f.style.marginLeft=(-g)+"px";f.style.marginTop=(-f.offsetHeight-a.offsetHeight)+"px"},getContent:function(a){return a._content}};exports.InfoWindow=InfoWindow;exports.InfoWindowDelegate=InfoWindowDelegate;
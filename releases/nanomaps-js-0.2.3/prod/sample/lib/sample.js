(function(){var d;function c(a){var b=$("#debugpane");if(!b.get(0)){b=$(document.createElement("div"));b.get(0).id="debugpane";b.appendTo(document.body)}else{b.append("<br>")}b.append(a);if(d){clearTimeout(d)}d=setTimeout(function(){d=null;b.remove()},5000);b.click(function(){b.remove()})}window.showDebugMessage=c;console.log=c})();(function(o){var p=o.nanomaps;var s,h,m,i,d=new p.ImgMarker({src:"orb_blue.png"}),l=new p.ImgMarker({src:"pin_pink.png"}),c=new p.EllipseMarker({className:"errorHalo",unit:"m"});var j={street:new p.TileLayer({tileSrc:"http://otile${modulo:1,2,3}.mqcdn.com/tiles/1.0.0/osm/${level}/${tileX}/${tileY}.png"}),sat:new p.TileLayer({tileSrc:"http://oatile${modulo:1,2,3}.mqcdn.com/naip/${level}/${tileX}/${tileY}.jpg"}),hyb:new p.TileLayer({tileSrc:"http://otile${modulo:1,2,3}.mqcdn.com/tiles/1.0.0/hyb/${level}/${tileX}/${tileY}.png"})};function a(t){if(t==="street"){s.detach(j.sat);s.detach(j.hyb);s.attach(j.street)}else{if(t==="aerial"){s.detach(j.street);s.attach(j.sat);s.attach(j.hyb)}}}function b(){var t=$("#map").get(0);var v=window.devicePixelRatio||1;s=new p.MapSurface(t,{});s.on("motion.longtap",function(w){var x=s.getLocation(w.x,w.y);showDebugMessage("Long tap: "+x.lat()+","+x.lng());w.handled=true});s.on("motion.click",function(w){if(w.count===1){var x=s.getLocation(w.x,w.y);w.handled=true;if(h){s.detach(h)}h=new p.InfoWindow();$(h.getContent()).text("Location: ("+x.lat()+", "+x.lng()+")");$(h.element).click(function(){if(h){s.detach(h)}});h.setLocation(x);s.attach(h)}});try{navigator.geolocation.getCurrentPosition(n,k,{maximumAge:Infinity,timeout:2000});setTimeout(function(){g()},2500)}catch(u){g()}f();e()}function f(){$("#zoomControl .zoomIn").click(function(){s.begin();s.zoomIn();s.commit(true)});$("#zoomControl .zoomOut").click(function(){s.begin();s.zoomOut();s.commit(true)});$("#btnStreet").click(function(){a("street")});$("#btnAerial").click(function(){a("aerial")})}function e(){$("#btnQuery").click(function(){var t=$("#txtQuery").val();q(t)})}function q(x){var z={format:"json",q:x,bounded:0,},w="http://open.mapquestapi.com/nominatim/v1/search",u,t,y=true;$.ajax({url:w,dataType:"json",jsonp:"json_callback",data:z,success:function(v){if(v.length==0){alert("No results found.");return}var A=v[0],C=Number(A.lat),B=Number(A.lon);l.setLocation({lat:C,lng:B});s.attach(l);s.begin();s.setLocation({lat:C,lng:B});s.setZoom(10);s.commit({})}})}function r(){s.setSize()}function g(t,u){if(m){return}if(!t){t={lat:47.604317,lng:-122.329773}}if(u){s.setZoom(u)}s.setLocation(t);a("street");m=true}function n(t){var u={lat:t.coords.latitude,lng:t.coords.longitude};g(u,13);c.settings.latitude=u.lat;c.settings.longitude=u.lng;c.settings.radius=t.coords.accuracy;s.update(c);d.setLocation(u);s.update(d);$(d.element).click(function(){if(h){s.detach(h)}h=new p.InfoWindow();$(h.getContent()).text("My Location");h.setLocation(u,{x:0,y:d.element.clientHeight/2});$(h.element).click(function(){if(h){s.detach(h)}});s.attach(h)});if(!i){i=navigator.geolocation.watchPosition(n,k)}}function k(t){console.log("Could not get location: "+t.message);g()}$(window).load(b);$(window).resize(r)})(window);
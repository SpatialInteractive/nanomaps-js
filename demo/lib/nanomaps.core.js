var nanomaps=(function(f){var h=0;function l(){}var k=l.prototype={};k._evt=k.listeners=function(m){var o=this.__evt,n;if(!o){this.__evt=o={}}n=o[m];if(!n){n=o[m]=[]}return n};k.addListener=k.on=function(m,n){this._evt(m).push(n)};k.once=function(m,n){this._evt(m+"$once").push(n)};k.removeListener=function(n,o){m(this._evt(n));m(this._evt(n+"$once"));function m(q){for(var p=q.length-1;p>=0;p--){if(q[p]===o){q.splice(p,1)}}}};k.removeAllListeners=function(m){this._evt(m).length=0;this._evt(m+"$once").length=0};k.emit=function(p){var n,q=this._evt(p),m=Array.prototype.slice.call(arguments,1),o=this["on"+p];if(typeof o==="function"){o.apply(this,m)}q=this._evt(p+"$once");for(n=0;n<q.length;n++){q[n].apply(this,m)}q.length=0;for(n=0;n<q.length;n++){q[n].apply(this,m)}};k.advise=function(n,o,r){var q=this[n],m,p;if(!q||!q.__stub__||!this.hasOwnProperty(n)){m=this[n]=c(q)}else{m=q}p=m[o];if(p){p.push(r)}};function c(n){var m=function(){var o,q=arguments.callee,p,r;p=q.before;for(o=0;o<p.length;o++){p[o].apply(this,arguments)}if(n){r=n.apply(this,arguments)}p=q.after;for(o=0;o<p.length;o++){p[o].apply(this,arguments)}};m.__stub__=true;m.before=[];m.after=[];return m}function j(n,m){return function(o){n.emit(m,o||window.event,this)}}function d(r,y){if(!y){y={}}var u=y.document||r.ownerDocument||window.document,n=y.width,x=y.height,t,v,p,w,m,s;function q(z){return u.createElement(z)}this.createElement=q;r.style.overflow="visible";t=r.style.position;if(t!="relative"&&t!="absolute"&&t!="fixed"){r.style.position="relative"}t=r.style.zIndex;if(t===""||t==="auto"){r.style.zIndex="inherit"}function o(){var z=q("div");z.style.overflow="hidden";z.style.position="absolute";z.style.left="0px";z.style.top="0px";z.style.width="100%";z.style.height="100%";return z}p=o();p.className="glass";p.style.display="block";r.insertBefore(p,r.firstChild);v=o();v.className="viewport";r.insertBefore(v,r.firstChild);w=q("div");w.className="managed";w.style.position="absolute";w.style.width="100%";w.style.height="100%";v.appendChild(w);this.elements={document:u,managed:w,viewport:v,glass:p,parent:r};if(typeof n!=="number"||typeof x!=="number"){this.setSize();n=r.clientWidth;x=r.clientHeight}else{this.setSize(n,x)}s=y.projection||new g.WebMercator();m=y.center||s.DEFAULT_CENTER;this.transform=new b();this.transform.init(s,y.resolution||s.DEFAULT_RESOLUTION,[m.lng,m.lat]);this.setCenter(m);this.initialize(y);this.collect()}var e=d.prototype=new l();e._each=function(n,r){var q=this.elements,p=q.managed,m=q.viewport;for(var o=m.firstChild;o;o=o.nextSibling){if(o.nodeType!==1||o===p){continue}r.call(this,o)}if(n){for(o=p.firstChild;o;o=o.nextSibling){if(o.nodeType!==1){continue}r.call(this,o)}}};e._notifyPosition=function(){this._each(true,function(m){var o=m.mapDelegate||{},n=o.onposition;if(typeof n==="function"){n.call(o,this,m)}})};e._notifyReset=function(){this._each(true,this._notifyResetSingle)};e._notifyResetSingle=function(m){var o=m.mapDelegate||a,n=o.onreset;if(typeof n==="function"){n.call(o,this,m)}};e.initialize=function(m){};e.eventToContainer=function(o,m){var n=this.elements[m||"viewport"],q=n,p={x:o.clientX,y:o.clientY};do{p.x-=q.offsetLeft;p.y-=q.offsetTop}while(q=q.offsetParent);p.x+=window.pageXOffset||0;p.y+=window.pageYOffset||0;return p};e.routeDomEvent=function(p,n,m){var o=this.elements[m||"viewport"],q=j(this,n||("dom_"+p));if(o.addEventListener){o.addEventListener(p,q,false)}else{if(o.attachEvent){o.attachEvent("on"+p,q)}}};e.attach=function(n){var m=window.HTMLElement?n instanceof HTMLElement:(n.nodeType===1);if(!m){n=n.createElement(this)}var o=n.mapDelegate||a,p=this.elements;n.style.position="absolute";if(o.unmanaged){p.viewport.insertBefore(n,p.managed)}else{p.managed.appendChild(n)}this._notifyResetSingle(n)};e.collect=function(){for(var m=this.elements.parent.firstChild;m;m=m.nextSibling){if(m.nodeType===1&&m.hasAttribute("latitude")&&m.hasAttribute("longitude")){this.attach(m)}}};e.update=function(m){if(!m.parentElement){this.attach(m)}else{this._notifyResetSingle(m)}};e.setSize=function(p,n){var o=this.elements.parent,m=this._center;if(arguments.length<2){o.style.left="";o.style.top="";p=o.clientWidth;n=o.clientHeight}o.style.width=p+"px";o.style.height=n+"px";this.width=p;this.height=n;if(m){this.setCenter(m)}};e.setCenter=function(m){this._updateCenter(m);this._notifyPosition()};e._updateCenter=function(r){var o=this.elements.managed,n=this.transform,q=r.lat||0,m=r.lng||0,p;this._center={lat:q,lng:m};p=n.toSurface(m,q);p[0]-=this.width/2;p[1]-=this.height/2;o.style.left=(-p[0])+"px";o.style.top=(-p[1])+"px"};e.getCenter=function(){return this._center};e.getResolution=function(){return this.transform.res};e.setResolution=function(p,q){var n=this._center,o,m,r;if(q){n=this.toLatLng(q.x,q.y);o=this.width/2-q.x;m=this.height/2-q.y}this.transform=this.transform.rescale(p,[n.lng,n.lat]);if(q){r=this.transform.fromSurface(o,m);if(r){n.lng=r[0];n.lat=r[1]}}this._updateCenter(n);this._notifyReset()};e.setLevel=function(q,o){var n=this.transform.prj,p=n.MIN_LEVEL,m=n.MAX_LEVEL;if(!q){return}if(q>m){q=m}else{if(q<p){q=p}}this.setResolution(n.fromLevel(q),o)};e.getLevel=function(){var m=this.transform;return m.prj.toLevel(m.res)};e.toLatLng=function(m,q){var n=this.transform,p=this.elements.managed,o;m-=parseInt(p.style.left);q-=parseInt(p.style.top);o=n.fromSurface(m,q);if(!o){return null}return{lng:o[0],lat:o[1]}};e.toGlobalPixels=function(m,p){var n=this.transform,o=this.elements.managed;m-=parseInt(o.style.left);p-=parseInt(o.style.top);return{x:m+n.zpx[0],y:n.zpx[1]-p}};e.moveBy=function(o,m){var n=this.toLatLng(this.width/2+o,this.height/2-m);if(n){this.setCenter(n)}};function i(m){var n=m.geo;if(!n){n={};if(isNaN(n.latitude=Number(m.getAttribute("latitude")||"NaN"))){return null}if(isNaN(n.longitude=Number(m.getAttribute("longitude")||"NaN"))){return null}n.xoffset=Number(m.getAttribute("xoffset")||"NaN");n.yoffset=Number(m.getAttribute("yoffset")||"NaN")}return n}var a={onreset:function(p,m){var o=i(m),n;if(o){n=p.transform.toSurface(o.longitude,o.latitude);if(n){n[0]+=Number(o.xoffset||0);n[1]+=Number(o.yoffset||0);m.style.left=(n[0])+"px";m.style.top=(n[1])+"px";m.style.display="block";return}}m.style.display="none"}};function b(){this.sequence=h++}b.prototype={init:function(m,n,o){this.prj=m;this.res=n;this.zll=o;this.zpx=this.toPixels(o[0],o[1])},rescale:function(n,o){var m=new b();m.init(this.prj,n,o);return m},toPixels:function(n,p){var o=this.prj.forward(n,p),m=this.res;if(!o){return null}o[0]/=m;o[1]/=m;return o},toSurface:function(m,o){var n=this.toPixels(m,o);if(!n){return null}n[0]-=this.zpx[0];n[1]=this.zpx[1]-n[1];return n},fromPixels:function(m,o){var n=this.res;return this.prj.inverse(m*n,o*n)},fromSurface:function(m,n){return this.fromPixels(m+this.zpx[0],this.zpx[1]-n)}};var g={WebMercator:function(p){if(!p){p={}}this.DEFAULT_CENTER={lat:39.7406,lng:-104.985441};this.DEFAULT_RESOLUTION=611.4962;var o=6378137,n=0.017453292519943295,m=57.29577951308232,s=0.7853981633974483,q=1.5707963267948966,r=78271.517;this.MIN_LEVEL=p.MIN_LEVEL||1;this.MAX_LEVEL=p.MAX_LEVEL||18;this.forward=function(t,u){return[t*n*o,Math.log(Math.tan(s+0.5*n*u))*o]};this.inverse=function(t,u){return[m*t/o,m*(q-2*Math.atan(Math.exp(-u/o)))]};this.fromLevel=function(t){return r/Math.pow(2,t-1)};this.toLevel=function(t){return Math.log(r/t)/Math.log(2)+1};p=null}};f.EventEmitter=l;f.MapSurface=d;f.Projections=g;f.MapTransform=b;return f})({});